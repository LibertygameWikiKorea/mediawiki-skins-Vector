@import '../../common/variables.less';
@import '../../common/mixins.less';

.mw-table-of-contents-container {
	// Needed for Grid-based layout
	align-self: start;
	height: 100%;
}

@media ( min-width: @min-width-desktop ) {
	#mw-panel-toc {
		.vector-toc-pinned & {
			// Support: Chrome
			// Work around sticky-positioned layers disabling subpixel text rendering (T327460).
			// NOTE: This property has an effect similar to 'overflow: hidden', and will prevent elements
			// inside of the panel from being rendered outside of its bounding box, even when they would
			// be positioned there using absolute positioning, negative margin, transforms, etc.
			// That's why the negative margins have to be applied here, instead of on #vector-toc.
			contain: paint;
		}

		// FIXME: `.vector-feature-page-tools-disabled.vector-toc-pinned` can be removed when cached HTML no longer an issue.
		.vector-feature-page-tools-disabled .vector-toc-pinned &,
		.vector-feature-page-tools-disabled.vector-toc-pinned & {
			// Align the left edge of the TOC text with the main menu button icon.
			margin-left: -27px;
		}

		// FIXME: `.vector-feature-page-tools-enabled.vector-toc-pinned` can be removed when cached HTML no longer an issue.
		.vector-feature-page-tools-enabled .vector-toc-pinned &,
		.vector-feature-page-tools-enabled.vector-toc-pinned & {
			// Align the left edge of the TOC text with the page container
			margin-left: -@spacing-subsection-toggle;
		}
	}

	#vector-toc-pinned-container {
		// stylelint-disable-next-line plugin/no-unsupported-browser-features
		position: sticky;
		// The design spec specifies 30px of space from the top of the viewport to the top of the pinned TOC (excluding top padding).
		top: @top-sticky-toc;

		.vector-toc {
			max-height: ~'calc( 100vh - @{top-sticky-toc} - @{max-height-bottom-spacing-scroll-indicator} )';
		}

		.vector-toc-pinned & {
			// Default spacing separating the sidebar TOC from the main menu or viewport.
			margin-top: 1.5em;
		}

		// FIXME: .vector-feature-page-tools-disabled.vector-toc-pinned can be removed when cached HTML no longer an issue.
		.vector-feature-page-tools-disabled .vector-toc-pinned @{selector-main-menu-closed} ~ .mw-table-of-contents-container &,
		.vector-feature-page-tools-disabled.vector-toc-pinned @{selector-main-menu-closed} ~ .mw-table-of-contents-container & {
			// Needed to align TOC with bottom of title.
			margin-top: @margin-top-pinned-toc;
		}

		// FIXME: .vector-feature-page-tools-enabled.vector-toc-pinned can be removed when cached HTML no longer an issue.
		.vector-feature-page-tools-enabled.vector-feature-main-menu-pinned-disabled .vector-toc-pinned &,
		.vector-feature-page-tools-enabled.vector-toc-pinned.vector-feature-main-menu-pinned-disabled & {
			// Align TOC with bottom of title when main menu is not pinned but the TOC is
			margin-top: @margin-top-pinned-toc;
		}

		.vector-feature-page-tools-enabled & .vector-toc {
			padding-left: @spacing-subsection-toggle;
			padding-right: @padding-horizontal-dropdown-menu-item;
			// Add extra padding for the fade scrollable indicator, which is 30px tall
			padding-bottom: @height-scroll-indicator - @padding-vertical-dropdown-menu-item;
		}

		// T302076: Add fade scrollable indicator when TOC is in sidebar
		// Avoid showing indicator when the TOC is floating, or collapsed in the page title/sticky header
		.vector-toc-pinned & .vector-toc:after {
			.mixin-vector-scroll-indicator();
		}
	}
}
